{% extends "partials/base.html" %}

{% block title %}{{ title }}{% endblock %}

{% block content %}
<h2>{{ title }}</h2>

<form method="POST">
    <div class="mb-3">
        <label class="form-label">Kode *</label>
        <input type="text" name="kode" class="form-control" value="{{ bahan.kode if bahan else '' }}" required>
    </div>
    <div class="mb-3">
        <label class="form-label">Nama Bahan *</label>
        <input type="text" name="nama_bahan" class="form-control" value="{{ bahan.nama_bahan if bahan else '' }}" required>
    </div>
    <div class="mb-3">
        <label class="form-label">Kuantitas *</label>
        <input type="number" step="0.01" name="kuantitas" class="form-control" value="{{ bahan.kuantitas if bahan else 0.0 }}" required>
    </div>
    <div class="mb-3">
        <label class="form-label">Satuan *</label>
        <select name="satuan" class="form-select" id="satuanSelect" required>
            <option value="">-- Pilih Satuan --</option>
            {% for satuan in satuan_bahan %}
            <option value="{{ satuan }}" {% if bahan and bahan.satuan == satuan %}selected{% endif %}>{{ satuan }}</option>
            {% endfor %}
            <option value="custom">Lainnya (isi manual)</option>
        </select>
    </div>
    <div class="mb-3" id="customSatuanField" style="display:none;">
        <label class="form-label">Satuan Manual *</label>
        <input type="text" name="satuan_manual" class="form-control" 
               value="{% if bahan and bahan.satuan not in satuan_bahan %}{{ bahan.satuan }}{% endif %}">
    </div>
    <div class="mb-3">
        <label class="form-label">Tanggal Masuk *</label>
        <input type="date" name="tgl_masuk" class="form-control" value="{{ bahan.tgl_masuk.strftime('%Y-%m-%d') if bahan else '' }}" required>
    </div>
    <div class="mb-3">
        <label class="form-label">Tanggal Expired</label>
        <input type="date" name="tgl_expired" class="form-control" value="{{ bahan.tgl_expired.strftime('%Y-%m-%d') if bahan and bahan.tgl_expired else '' }}">
    </div>
    <div class="mb-3">
        <label class="form-label">Status Expired</label>
        <select name="status_expired" class="form-select">
            <option value="belum expired" {% if not bahan or bahan.status_expired == 'belum expired' %}selected{% endif %}>Belum Expired</option>
            <option value="expired" {% if bahan and bahan.status_expired == 'expired' %}selected{% endif %}>Expired</option>
        </select>
    </div>
    <div class="mb-3">
        <label class="form-label">Catatan</label>
        <textarea name="catatan" class="form-control" rows="3">{{ bahan.catatan if bahan else '' }}</textarea>
    </div>
    <button type="submit" class="btn btn-primary">Simpan</button>
    <a href="{{ url_for('bahan_list') }}" class="btn btn-secondary">Batal</a>
</form>

<script>
document.getElementById('satuanSelect').addEventListener('change', function() {
    const customField = document.getElementById('customSatuanField');
    customField.style.display = this.value === 'custom' ? 'block' : 'none';
});

// Inisialisasi saat halaman dimuat
document.addEventListener('DOMContentLoaded', function() {
    const select = document.getElementById('satuanSelect');
    const customField = document.getElementById('customSatuanField');
    if (select.value === 'custom') {
        customField.style.display = 'block';
    }
});
</script>
{% endblock %}